{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/aws/aws-networks/","result":{"data":{"markdownRemark":{"id":"7e51f451-3490-5a65-87bd-9982dbd89d8a","html":"<p>aws를 기본적인 사용을 위해 가장 기본적이면서 기초적인 aws 설계 내용을 terraform으로 구현하고 무엇인지 설명</p>\n<h2 id=\"사전-준비\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EC%A0%84-%EC%A4%80%EB%B9%84\" aria-label=\"사전 준비 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사전 준비</h2>\n<ul>\n<li>terraform</li>\n<li>awscli(계정 &#x26; credentials 셋팅 포함)</li>\n<li>aws key pair</li>\n</ul>\n<blockquote>\n<p>key pair는 베스천 서버 구축을 위한 것으로(ec2 접속을 비밀번호가 아닌 ssh로 접속) 셋팅이 안되어 있다면 <a href=\"https://github.com/qweasd147/StudyNote/tree/master/terraform/key_pair\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">여기</a> 를 참고해서 privacy key를 aws에 등록 시켜놓는다.</p>\n</blockquote>\n<h1 id=\"모듈-별-구성-및-설명\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%88-%EB%B3%84-%EA%B5%AC%EC%84%B1-%EB%B0%8F-%EC%84%A4%EB%AA%85\" aria-label=\"모듈 별 구성 및 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모듈 별 구성 및 설명</h1>\n<h2 id=\"1-networks\" style=\"position:relative;\"><a href=\"#1-networks\" aria-label=\"1 networks permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. networks</h2>\n<p>실행은 <a href=\"https://github.com/qweasd147/StudyNote/tree/master/terraform/vpc_ec2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">terraform vpc_ec2</a>에서 pull 받고 하나씩 실행한다.</p>\n<p>먼저 위의 프로젝트를 <code class=\"language-text\">pull</code>받고 기본적인 <code class=\"language-text\">network</code>먼저 구축한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ terraform init\n$ terraform apply</code></pre></div>\n<p>프로비저닝이 끝나면 아래 이미지 처럼 가장 기본적인 네트워크가 구축 된다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/a2ed6a913c9a3e540207f9b69499918e/bab36/networks.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVQoz22SW2sUQRCF5///DQ24GyPkxSAI+uJTQCEPKknMJrtz2Z3ZufS9e26fTJvECBZ9qO6uqlPdh0rmeWYBy4qYmabpGeM4Rq+1QghJmhX/5DzFn3gSHu3b1RUfPn1ECIGQEq01xhqsczjvaRuJ9w5jLVIppJJoo7HOxrwnS9qmRaqWX98rLj/XtFKw3RURZdXiB9BqIL3tcGHC+pHq2HEoGzphcGGmaRVd11LXNcl6tWb99oSHH5qrLzWXP9dkaUGabTkccqQWGGeRnaaSGV9vzunalk7U1HWJdio2X6/XrFYrkmNZIqoKKyUhdAy9pMoM4zhFXf3g6acQv+MGSz9IhjDRlT5qHoKlKkqOWY7sOpK2bQneoWuJaAT75kC+T2PnfvSY3hDGPhKq4CmtRBnJw/aeYCVaNlTpnraq8N6TvL+44M3rV1S7glw5Tm9veEh3bLIUN/R0wWOHMRLea83J9TV3mzu2+xzXB1Qf2NznnJ+e8u7sjGSf5+yLHCktup+ZlsrpcYYAP07PhIuflvsX8TDNFJXgUBQsXAnDwGwMphGITuHGfpGOcZ6YmTHDgB2HWPxy/xzvA1WtFjFZuJKyLKmPR1SnUHpEuhHtJ7SbMH5C2DGOBgPx3NoB5f7kLRCmZ7dJye7ucMaQNG0XX7QIqrRBLlAvoA1GW4yx0ev/wfwd7N/KC0cDeOXelgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/a2ed6a913c9a3e540207f9b69499918e/24599/networks.webp 238w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/69f92/networks.webp 475w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/cebde/networks.webp 950w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/ab1e2/networks.webp 1425w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/97775/networks.webp 1900w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/57d79/networks.webp 1906w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/a2ed6a913c9a3e540207f9b69499918e/da2e6/networks.png 238w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/abae4/networks.png 475w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/68327/networks.png 950w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/fe5a5/networks.png 1425w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/a7a60/networks.png 1900w,\n/blog/static/a2ed6a913c9a3e540207f9b69499918e/bab36/networks.png 1906w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/a2ed6a913c9a3e540207f9b69499918e/68327/networks.png\"\n            alt=\"aws netowkrs\"\n            title=\"aws netowkrs\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"11-vpcvirtual-private-cloud\" style=\"position:relative;\"><a href=\"#11-vpcvirtual-private-cloud\" aria-label=\"11 vpcvirtual private cloud permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.1 VPC(Virtual Private Cloud)</h3>\n<p>이미지의 보라색 테두리 영역으로 영어 그대로 사설 네트워크 공간을 말한다. 즉 개인만의 네트워크 공간을 구축하고 하위에 리소스들을 프로비저닝 할 수 있는 네트워크 공간이 만들어 진것이다.</p>\n<h3 id=\"12-region--availity-zone\" style=\"position:relative;\"><a href=\"#12-region--availity-zone\" aria-label=\"12 region  availity zone permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.2 Region / Availity ZONE</h3>\n<ul>\n<li>Region : 보통 나라 별 데이터 센터 클러스터링 단위. <code class=\"language-text\">AZ(Availity ZONE)</code>을 <code class=\"language-text\">grouping</code> 한거라고 생각하면 된다 (서울, 도쿄 리전 등)</li>\n<li>Availity ZONE : 물리적으로 분리 되어있는 인프라가 모여있는 Region 내 데이터 센터</li>\n</ul>\n<blockquote>\n<p>쉽게 생각하면 나라별 데이터 센터(AZ)가 있고, 각각 데이터 센터를 묶어 Region을 만든다고 생각하면 된다(정확한 설명은 아님).</p>\n</blockquote>\n<h3 id=\"13-subnet\" style=\"position:relative;\"><a href=\"#13-subnet\" aria-label=\"13 subnet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.3 Subnet</h3>\n<p><code class=\"language-text\">VPC</code>를 자잘하게 나눈 <code class=\"language-text\">networks</code> 영역. 하나의 서브넷은 하나의 <code class=\"language-text\">AZ</code>에서만 존재 가능하고, <code class=\"language-text\">subnet</code>을 구성하는 속성으로 <code class=\"language-text\">public subnet</code> 또는 <code class=\"language-text\">private subnet</code> 한 가지를 선택 하여야 한다.</p>\n<ul>\n<li>public subnet : 이 <code class=\"language-text\">subnet</code>에 만든건 외부에서 직접 통신이 가능하도록 만들기 위해 사용됨. 또 이 subnet에 만든건 public ip를 바로 부여하도록 셋팅이 가능하다</li>\n<li>private subnet : 이 <code class=\"language-text\">subnet</code>에 만든 resource들은 외부와 직접 통신이 불가능하고 중간 다리 역할을 하는 resource를 거쳐야 한다. 자동으로 public ip 부여 x</li>\n</ul>\n<h3 id=\"14-routing-table\" style=\"position:relative;\"><a href=\"#14-routing-table\" aria-label=\"14 routing table permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.4 Routing Table</h3>\n<p>트래픽이 어디로 가야하는지(갈 수 있는지) 정의 한 테이블. 이하 <code class=\"language-text\">RT</code></p>\n<p><strong>사용 예시</strong></p>\n<ul>\n<li><code class=\"language-text\">public</code> 서브넷의 <code class=\"language-text\">RT</code>의 구성은 목적지가 <code class=\"language-text\">vpc cidr block</code>과 같으면 내부에서 처리 하는 트래픽, 그게 아니라면 무조건 <code class=\"language-text\">IGW</code>로 보내도록 셋팅한다.\n<blockquote>\n<p>내부에서 내부로 요청하는건 내부에서 처리, 내부에서 외부로 요청하는거면 <code class=\"language-text\">IGW</code>로 보냄</p>\n</blockquote>\n</li>\n<li><code class=\"language-text\">private</code> 서브넷의 <code class=\"language-text\">RT</code>의 구성은 목적지가 <code class=\"language-text\">vpc cidr block</code>과 같으면 내부에서 처리 하는 트래픽, 그게 아니라면 <code class=\"language-text\">Nat Gateway</code>로 보낸다.\n<blockquote>\n<p>내부에서 내부로 요청하는건 내부에서 처리, 내부에서 외부로 요청하는거면 <code class=\"language-text\">Nat Gateway</code>로 보냄(직접 외부로 보내는건 불가능)</p>\n</blockquote>\n</li>\n</ul>\n<p><code class=\"language-text\">RT</code>이 존재해야 <code class=\"language-text\">subnet</code>이 달라도 같은 <code class=\"language-text\">vpc</code>안에 구성되어 있다면 <code class=\"language-text\">subnet</code> 간 통신이 가능하다.</p>\n<h3 id=\"15-nat-gateway\" style=\"position:relative;\"><a href=\"#15-nat-gateway\" aria-label=\"15 nat gateway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.5 Nat Gateway</h3>\n<p><code class=\"language-text\">private instance</code>가 외부의 인터넷과 통신하기 위한 통로로 사용되며, 하나의 공인 <code class=\"language-text\">ip</code>를 부여 할 수 있다(<code class=\"language-text\">elastic ip(EIP)</code>로 부여함). <code class=\"language-text\">Nat Gateway</code>는 고가용성 확보를 위해 여러 서브넷이 만들 수도, 아님 하나의 서브넷에 만들어 같이 사용 할 수도 있다. 물론 하나만 사용하면 해당 <code class=\"language-text\">AZ</code>이 문제가 되면 내부망은 외부와 통신 할 수가 없게 된다.</p>\n<p><code class=\"language-text\">Nat Gateway</code>는 <code class=\"language-text\">public subnet</code>에 있어야 하고, 부여 된 공인 IP를 통해 외부와 통신하게 되므로 외부의 인터넷에선 해당 IP로 요청을 보낸것으로 간주된다.</p>\n<h3 id=\"16-internet-gatewayigw\" style=\"position:relative;\"><a href=\"#16-internet-gatewayigw\" aria-label=\"16 internet gatewayigw permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.6 Internet Gateway(IGW)</h3>\n<ul>\n<li>인터넷으로 나가는 통로. 이게 없으면 <code class=\"language-text\">vpc</code>는 외부와 아예 격리되게 된다.</li>\n<li>기본적인 고가용성이 확보되어 있음(2개 안만들어도 됨)</li>\n<li>IGW 로 연결되어 있지 않은 서브넷 = <code class=\"language-text\">Private Subnet</code></li>\n<li>하나의 <code class=\"language-text\">vpc</code>에만 연결 가능 (<code class=\"language-text\">vpc</code>는 하나의 <code class=\"language-text\">IGW</code>를 갖는다)</li>\n<li>IGW가 없으면 실질적으로 전부 <code class=\"language-text\">private subnet</code>이 된다고 생각하면 된다(내부에서 인터넷을 못씀).</li>\n</ul>\n<h3 id=\"17-cidr-block\" style=\"position:relative;\"><a href=\"#17-cidr-block\" aria-label=\"17 cidr block permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1.7 cidr block</h3>\n<p>그냥 <code class=\"language-text\">vpc</code> 또는 <code class=\"language-text\">subnet</code>별 사용 할 수 있는 <code class=\"language-text\">private ip</code>범위라고 이해하는게 제일 편하다. <code class=\"language-text\">private network</code>에서 여러 ip 부여 및 관리를 위해 만들어졌다.</p>\n<p><code class=\"language-text\">terraform</code>코드에선 vpc의 <code class=\"language-text\">cidr block</code>값을 <code class=\"language-text\">10.0.0.0/16</code> 이렇게 정하였고, 이 vpc에 만들어지는 <code class=\"language-text\">private ip</code>는 모두 <code class=\"language-text\">10.0.x.x</code>으로 시작하게 된다.</p>\n<blockquote>\n<p>16의미 -> 앞의 16비트를 네트워크 주소로 사용, 나머지 16비트를 호스트 주소로 사용</p>\n</blockquote>\n<p>또 <code class=\"language-text\">AZ1</code>에 배치한 <code class=\"language-text\">private subnet</code>인 <code class=\"language-text\">private subnet-2a</code>는 <code class=\"language-text\">cidr block</code>값으로 <code class=\"language-text\">10.0.101.0/24</code>를 부여했는데, 이 서브넷에 생성되는 ec2 등은 <code class=\"language-text\">private ip</code>는 모두 <code class=\"language-text\">10.0.101.x</code>로 시작하게 된다.</p>\n<p>반대로 생각하면 부여받은 <code class=\"language-text\">private ip</code>값으로 어느 서브넷, AZ에 배치되는지 확인이 가능하다.</p>\n<h2 id=\"2-ec2-web-server\" style=\"position:relative;\"><a href=\"#2-ec2-web-server\" aria-label=\"2 ec2 web server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. ec2-web-server</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/df264/ec2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.20168067226891%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACGUlEQVQoz02SW2vbQBCF9f9/R0prBZpCoYVCIU99yUNLCqGkiR1fZUu2tPeLVtJXJDuhA4fZszucnbM72TAMjBhjTBPve/oLuq6bsjEaKSWbbTEV/n8+9GeNERmX+Pn7nm+335FKIpXCWIN1Fuc9PniaWhGCxzqH0hqlzzXOO5xzrzJkTSNQRvD8UHF3e6RRitW6mFBWDSGB1onNs8THHh86qqPgUNYIafFxoGkUQgjquibLZzn59TuWD5r7Hyfu/uRsNwW77YryUCCNxHqHFIZSrvn19BnRCIQ8cTqVWG94We6YzWbkeU52LEtkWeKkIraC1CqOhcecDnTBE7uWtouTHd9aUtK0sUdUYXrzEB1VUXLc7tBSjpYbgnfoo0I2kn19YH/YstmtMFbikyOmdhJU0VM5hTaS5eqF6BRG1VSbPU1VEUMg+/L1Kx+urihXOwrjuX76y3KzYlkUhL5HxIDruklwrg3vHx95XsxZHfb4NqLbyHyx5VOec/Pxhmy/27HfFyjpsGmgZ5wdoEswdtcPuJQmwddMitCef3a8tKgkh6KYkJESvTWYk0RJjb/Yk+JEXSxQMeIvHZrU4rse1ZTUhyX9MGDbSHVUECOjVlaWJfXpiG40xnYo32FCj7QJaTuES4Q4MCSm/ZE3pqU2aaqVtmU9X7NbLPDOkdWNmByGENDGokZoO61fuTXuDWbM9gxz4cbat8H+B0sLRY98St7XAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/24599/ec2.webp 238w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/69f92/ec2.webp 475w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/cebde/ec2.webp 950w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/ab1e2/ec2.webp 1425w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/7bcab/ec2.webp 1878w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/da2e6/ec2.png 238w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/abae4/ec2.png 475w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/68327/ec2.png 950w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/fe5a5/ec2.png 1425w,\n/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/df264/ec2.png 1878w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/57ef2f09beb9fcf3479cbd4c6df06a20/68327/ec2.png\"\n            alt=\"ec2 web server\"\n            title=\"ec2 web server\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>네트워크를 구성 한 후, 각 <code class=\"language-text\">private subnet</code>에 웹서버로 사용 할 <code class=\"language-text\">ec2</code>를 올리고, 하나의 <code class=\"language-text\">public subnet</code>에 <code class=\"language-text\">bastion server</code>로 사용 할 <code class=\"language-text\">ec2</code>까지 올린 형태이다. <code class=\"language-text\">bastion server</code>에 <code class=\"language-text\">EIP</code>를 부여하면 고정된 ip 사용이 가능하겠지만, <code class=\"language-text\">EIP</code>가 저렴한 서비스는 아니니까 그냥 그때그때 생성되는 ip를 사용해도 무방하다.</p>\n<p>앞서 terraform을 사용해서 프로비저닝 하면 아래와 같은 내용이 출력 될 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">alb_dns_name = \"xxxx.elb.amazonaws.com\"\nbastion-public-ip = \"{배스천 ec2 public ip}\"\nserver-private-ip = {\n  \"web-2a\" = \"{웹서버 private ip1}\"\n  \"web-2c\" = \"{웹서버 private ip2}\"\n}</code></pre></div>\n<p>ssh 접근에 필요한 key 파일값이 <code class=\"language-text\">~/.ssh</code>위치에 있다는 가정하에</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ ssh -i ~/.ssh/{private key 파일명} ec2-user@{배스천 ec2 public ip}</code></pre></div>\n<p>이런 식으로 베스천 서버에 접근 하거나 아님 <code class=\"language-text\">~/.ssh/config</code> 파일에 아래와 같은 bastion 서버 정보를 입력 후,</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">Host aws-bastion\n    HostName {배스천 ec2 public ip}\n    Port 22\n    User ec2-user\n    IdentityFile ~/.ssh/{private key 파일명}</code></pre></div>\n<p><code class=\"language-text\">$ ssh aws-bastion</code> 명령어 만으로도 <code class=\"language-text\">bastion</code> 서버 ssh 접속이 가능하게 구성 할 수도 있다. 아무튼 베스천 서버에 접석 한 이후엔 aws 네트워크에 접속 한 것이고, <code class=\"language-text\">RT</code>도 다 구축하였으니 다른 서브넷에 위치한 웹서버들로도 요청을 보내 볼 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"># 베스천 서버로 접속 이후 실행\n$ curl {웹서버 private ip1}\n$ curl {웹서버 private ip2}</code></pre></div>\n<p>이런 식으로 프로비저닝 된 각 웹서버들로 요청을 보내고 값을 전달 받을 수도 있다.</p>\n<blockquote>\n<p>terraform에 해당 모듈에 <code class=\"language-text\">init-script.sh</code>스크립트를 보면 apache 웹서버를 설치하고 시작 하는 내용을 확인 할 수있다. 이 스크립트를 프로비저닝이 완료 된 후 실행되도록 셋팅하여, 80포트가 open 되어 있는것이다.</p>\n</blockquote>\n<blockquote>\n<p>보안 관련 Security Group 관련 설명은 생략</p>\n</blockquote>\n<h2 id=\"2-alb\" style=\"position:relative;\"><a href=\"#2-alb\" aria-label=\"2 alb permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. alb</h2>\n<p>아래 이미지는 <code class=\"language-text\">ELB</code>까지 사용하여 최종 완성 된 형태이다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/0ad51d82aba132098526ef881ccbf283/c0ee7/elb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.20168067226891%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHklEQVQoz12Si2rUQBSG8/5vIa2VlqLUUp9AxUIVKrSgbeluNtlsbjuXzC3XTxK7RRz4mTm3/xzO/NE0Tcw4nMUeJ8ZxXDAMw3JbaxBCku3yJe/f+IFjRnQg+nZzw+frryitUFpjrME6i/OeEAL7Wiyks083zQJj57jDe/86UDR3tU5z92PL9y8l2ljSbcEmyalqRTuAki3bZ03bgw8jRSnIS4HSDt9OCKGRUiClJDo5eceHj+fE9z0/r3Ou789I4pQ0XZNlCY3VWBeoKkkuV9w+XqGkQsiKui5wreXpKeHo+IiLiwuifLtF5AVOarpB4r2k3gW8LBnagO8t3g+oEmynCa2g9RN63zFOE943VFnFbr1GK0WklFoKm0KhpWBXZWR5SpysME5RuZJm3pMLFE6y0TlKC+J4Rec1jSqptxVqXy+fFF1eXnJ+eopISzbG8v7xgVW8JikKwjSRGcnwooJfWvPm7pbn1TNJkeO6gO46nn6vOHt7zKerK6J0syFNE5RyuHGkHyeY64ceOkvlDf04LoS27zGdg9bC0C0+N8yfpNjEMdl2S8SsI2toSkVjGnz/N1HLmjx9oHDNsqu5y0yoWk+ZrxBVtkyugkfuDbSBmSsqigKxr2mEwbge7QZMGFG2R9kB6Qa6Dqaexa/9gJ79tsf4EWU64sc12XpNGwJRvRfLRLM4G2MXHerGLu+DbYzDGof5P9a8xK17FfYf3WlEd9GBtZkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/0ad51d82aba132098526ef881ccbf283/24599/elb.webp 238w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/69f92/elb.webp 475w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/cebde/elb.webp 950w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/ab1e2/elb.webp 1425w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/cfe61/elb.webp 1870w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/0ad51d82aba132098526ef881ccbf283/da2e6/elb.png 238w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/abae4/elb.png 475w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/68327/elb.png 950w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/fe5a5/elb.png 1425w,\n/blog/static/0ad51d82aba132098526ef881ccbf283/c0ee7/elb.png 1870w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/0ad51d82aba132098526ef881ccbf283/68327/elb.png\"\n            alt=\"alb\"\n            title=\"alb\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><code class=\"language-text\">ELB(ALB)</code>를 생성하여 <code class=\"language-text\">Target Group</code>에 연결하고, 이 <code class=\"language-text\">Target Group</code>은 생성한 웹서버들을 연결 시키면 <code class=\"language-text\">ALB</code>로 요청이 들어오면 각 웹서버들로 트래픽이 가도록 셋팅 한 것이다.\n해당 모듈은 SG 설정은 처음하는 사람한텐 조금 헤깔릴 수 있지만 개념자체는 어려운 개념이 아니니 추가 설명은 생략</p>","fields":{"slug":"/posts/aws/aws-networks/","tagSlugs":["/tag/aws/","/tag/db/","/tag/auroradb/"]},"frontmatter":{"date":"2024-12-29T15:56:13.293Z","description":"Terraform으로 IGW 부터 ELB까지 구축 및 설계","tags":["aws","db","auroradb"],"title":"Terraform으로 구축하는 AWS 기본 설계","socialImage":null}}},"pageContext":{"slug":"/posts/aws/aws-networks/"}},"staticQueryHashes":["251939775","2839666046","2891173899","401334301"]}