{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/java/java-async-profiler/","result":{"data":{"markdownRemark":{"id":"1fba32a4-3241-50e3-8d67-8c5316b6d94b","html":"<h1 id=\"async-profiler\" style=\"position:relative;\"><a href=\"#async-profiler\" aria-label=\"async profiler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Async Profiler</h1>\n<p>서비스를 운영하다 보면 병목이나 특정 메소드에서 서버 리소스를 많이 사용하는 부분이 생길 수도 있다. 이러한 지점을 찾기 위한 도구로, 어느 구간에서 cpu를 많이 사용하는지, 어느 구간에서 메모리(<code class=\"language-text\">heap</code>, <code class=\"language-text\">native memory</code>)를 많이 쓰는지를 시각화 하여 보여준다.\n<a href=\"https://github.com/async-profiler/async-profiler\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">해당 서비스</a>에선 아래와 같은 항목들 추적이 가능하다.</p>\n<blockquote>\n<p>What can be profiled:</p>\n<ul>\n<li>CPU time</li>\n<li>Allocations in Java Heap</li>\n<li>Native memory allocations and leaks</li>\n<li>Contended locks</li>\n<li>Hardware and software performance counters like cache misses, page faults, context switches</li>\n</ul>\n</blockquote>\n<p>이러한 항목들을 샘플링 방식으로 스레드 단위로 수집하여 어떠한 스레드가 리소스를 많이 사용한건지 확인 가능하며, 오버헤드도 상당히 낮은 수준으로 수집하여 필요하면 운영환경에서도 사용하도록 제공해주고 있다.</p>\n<h1 id=\"intellij-profiler\" style=\"position:relative;\"><a href=\"#intellij-profiler\" aria-label=\"intellij profiler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IntelliJ Profiler</h1>\n<p><code class=\"language-text\">IntelliJ</code>에서 <code class=\"language-text\">Async Profiler</code> 비스무리하게 만들어 제공해주는 기능으로 앞서 소개한 항목에 추가로 <code class=\"language-text\">total time</code>도 함께 제공해주고 있어, 병목지점까지 한눈에 볼 수 있게 제공해주고 있다.</p>\n<h2 id=\"1-cpu-사용량을-통한-병목지점-확인\" style=\"position:relative;\"><a href=\"#1-cpu-%EC%82%AC%EC%9A%A9%EB%9F%89%EC%9D%84-%ED%86%B5%ED%95%9C-%EB%B3%91%EB%AA%A9%EC%A7%80%EC%A0%90-%ED%99%95%EC%9D%B8\" aria-label=\"1 cpu 사용량을 통한 병목지점 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. CPU 사용량을 통한 병목지점 확인</h2>\n<p>예를들어 아래와 같은 예시가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token comment\">// CpuTest.kt</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> first <span class=\"token operator\">=</span> <span class=\"token function\">IntArray</span><span class=\"token punctuation\">(</span><span class=\"token number\">100_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> Random<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> seconds <span class=\"token operator\">=</span> <span class=\"token function\">IntArray</span><span class=\"token punctuation\">(</span><span class=\"token number\">50_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> Random<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">countSameNumberUsingList</span><span class=\"token punctuation\">(</span>first<span class=\"token punctuation\">,</span> seconds<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">countSameNumberUsingList</span><span class=\"token punctuation\">(</span>first<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> seconds<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> elapsed <span class=\"token operator\">=</span> measureTimeMillis <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x <span class=\"token keyword\">in</span> first<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token keyword\">in</span> seconds<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                count<span class=\"token operator\">++</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"공통 숫자 개수=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">count</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"List 걸린시간(ms)=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">elapsed</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>두 리스트 <code class=\"language-text\">first</code>, <code class=\"language-text\">seconds</code>에서 랜덤하게 숫자를 채우고, 같은 숫자 개수를 구하는 내용이다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 580px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/11695b6f576ab65dca53b1f5cd9619b9/12f38/intellij-profiler1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.378151260504204%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1ElEQVQoz3XSbWvTYBTG8XyPDVybdm1W2Jxbnu/cSbosbdNmyfpgW8HpWrs3gg6ZykSF+oTg0I/8l8ayN9IXPzic69XhOoorA1wZbuavNPHCE3pJwnCYMRrlTCZ9sqyNDC1k5CB9G+lZKMIPkdJFSgfpOfj+el4TwsK2dYTnIPO3xE9/0Ln4hj/5ijv8gpl/wMzfYJ2/x8o/oxiWi//4lmR+R3d2x9niN735HcnlL7LFHzrPfhJOv+MmM+x4TvZ8yWixJLlYIvq3mN1XWN0rrPQlVnqDUlardAcvGMw+kl9+Yny1JHnyjrD/mmh0TTS8Jh7fIFpTXEcnjpu02xHxqY/nGnjCxBM2nrDwhIFSqVTpndq02006nZg07RAEAscxcBxzzcAVDiI4oZf16eUrA5I0J4haeGGEDKMiV1S1Qhi16GXnRK2kKMDxgiIsFIVEmLagUq1Sq9Wp1etoe3vUNY3d3VqxV6s1jnUdZRUIGXCW92kl3ULcTliV9e8DgmI2bAdVLVMu/09VVUqlEo90E2X/4AAZnjAaT0nSjKjVKax2XtAsrM6xhaTRaGykaRq1uoayUypxpJuYtsvhkX7vSDfuHRsW+w8P2d7e3mhra4vSzgP+Ai3iOdBz/8jdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/11695b6f576ab65dca53b1f5cd9619b9/24599/intellij-profiler1.webp 238w,\n/blog/static/11695b6f576ab65dca53b1f5cd9619b9/69f92/intellij-profiler1.webp 475w,\n/blog/static/11695b6f576ab65dca53b1f5cd9619b9/2af67/intellij-profiler1.webp 580w\"\n              sizes=\"(max-width: 580px) 100vw, 580px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/11695b6f576ab65dca53b1f5cd9619b9/da2e6/intellij-profiler1.png 238w,\n/blog/static/11695b6f576ab65dca53b1f5cd9619b9/abae4/intellij-profiler1.png 475w,\n/blog/static/11695b6f576ab65dca53b1f5cd9619b9/12f38/intellij-profiler1.png 580w\"\n            sizes=\"(max-width: 580px) 100vw, 580px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/11695b6f576ab65dca53b1f5cd9619b9/12f38/intellij-profiler1.png\"\n            alt=\"intellij-profile1\"\n            title=\"intellij-profile1\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span> 버튼을 누르면 해당 프로그램을 <code class=\"language-text\">IntelliJ Profiler</code>로 실행 된다.</p>\n<blockquote>\n<p>주황색 아이콘은 VisualVM 버튼으로 IntelliJ와 연동해서 사용하고 있는데, AsyncProfiler와 무관하니 무시</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Profiling started\n공통 숫자 개수=2\nList 걸린시간(ms)=2443</code></pre></div>\n<p>프로그램이 종료 되고, <code class=\"language-text\">Show Results</code> 버튼을 누르면 아래와 같은 화면이 출력된다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/b4ad3/intellij-profiler2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSklEQVQoz5WQXU/CMBRA+VcqbG3XbWygYxsIDlQIigsa5EMQHjQ++MeP6RwGiS8+nNy2tzn3o3I+eCG6XqHbc6zoCe2HKNfD8epI7VKzJTWhfrCkg3BcbKVRro8fNvGCRnE3VNJ+TpJNUI0MEXSxlUv1QGIEf533mL8Gk7OEQ6UeBgSNEO25SKWQ2iuSplrx6Z9U9hWqtiokRnhStTit2VRtcdDdEaLk560UHtrNvhwvIOlcEbd7+OEFUvtYUh+N6vxJMfJ+LyaeWYJmFDNfblisNuTTGZe9AVFyScuQdonTLq2kQxS3uWilKK2xpUSUXf4SnlqCJD7nYzvlfZPztn5gtxizm49YTgc8T3os8ozZXYfpMOJx2GIyCLnvB4yzEOnoY6EkjXw+133eZ21eJ3W2DwHrsWZxa39z8x2XQ1EiWY0ky6HC912+AAj8JwZDYmILAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/24599/intellij-profiler2.webp 238w,\n/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/69f92/intellij-profiler2.webp 475w,\n/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/cebde/intellij-profiler2.webp 950w,\n/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/5c666/intellij-profiler2.webp 1080w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/da2e6/intellij-profiler2.png 238w,\n/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/abae4/intellij-profiler2.png 475w,\n/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/68327/intellij-profiler2.png 950w,\n/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/b4ad3/intellij-profiler2.png 1080w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/de41b4d6f1e8531150cb67e7143f7ba0/68327/intellij-profiler2.png\"\n            alt=\"intellij-profile2\"\n            title=\"intellij-profile2\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h3 id=\"왼쪽-상단-메뉴\" style=\"position:relative;\"><a href=\"#%EC%99%BC%EC%AA%BD-%EC%83%81%EB%8B%A8-%EB%A9%94%EB%89%B4\" aria-label=\"왼쪽 상단 메뉴 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왼쪽 상단 메뉴</h3>\n<ol>\n<li>Flame Graph</li>\n</ol>\n<p>왼쪽엔 실행 된 스레드명을 나열하고 오른쪽엔 호출된 call stack별로 메소드들을 확인 할 수 있다. x축이 넓을수록 리소스를 많이 사용한 부분이고, y축은 call stack기준으로 메소드들을 보여준다. 갈색은 java 코딩한 메소드, 회색은 라이브러리를 보여준다.</p>\n<p>이미지를 기준으로 보자면 <code class=\"language-text\">DestroyJavaVM</code>이란 스레드가 대부분의 cpu를 사용했고, <code class=\"language-text\">countSameNumberUsingList</code> -> <code class=\"language-text\">measureTimeMillis</code> -> <code class=\"language-text\">ArrayList.contains</code> 메소드가 대부분의 cpu를 사용했다는 점을 확인 할 수 있다.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 899px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/6320c3cbcd3799b6346197a14eaf5835/f7121/intellij-profiler3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.89075630252101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGElEQVQY013PbU+CYBTGcT6UFhTiE4jADTeiZs75UIYaolm5pDU326qtT/1v2rLVi9+u8+LsXDtKu9MjnqWMJwnD6wlhs4uQrX/a1L0Qqy6oOf4hixULo2xSrJjHeU/p9gbM0xWzZMH0NmVfIBsXyKhD+KN5+S3q4AiJkBFCNrDqHqbtYrs+vmwSNNoo6bTP527F28uC9+2SXZbwmiXsnmKy5ZDNon90fxPiOLXD0aARHdS9ANMySa8kD5MIJRl4fKzbbOcBWVzjeWKTxRabcYn1yOBxWDhaD3WEa+KHLcKohSP8w5umVeWuX2A9KqAYxQK6rnF+pqKe5n6peTTt5A9VzaEbRRwRYLseFcvGKFcxSmU0db+T5wvXp8PZflUoOAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/6320c3cbcd3799b6346197a14eaf5835/24599/intellij-profiler3.webp 238w,\n/blog/static/6320c3cbcd3799b6346197a14eaf5835/69f92/intellij-profiler3.webp 475w,\n/blog/static/6320c3cbcd3799b6346197a14eaf5835/fc12c/intellij-profiler3.webp 899w\"\n              sizes=\"(max-width: 899px) 100vw, 899px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/6320c3cbcd3799b6346197a14eaf5835/da2e6/intellij-profiler3.png 238w,\n/blog/static/6320c3cbcd3799b6346197a14eaf5835/abae4/intellij-profiler3.png 475w,\n/blog/static/6320c3cbcd3799b6346197a14eaf5835/f7121/intellij-profiler3.png 899w\"\n            sizes=\"(max-width: 899px) 100vw, 899px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/6320c3cbcd3799b6346197a14eaf5835/f7121/intellij-profiler3.png\"\n            alt=\"intellij-profile3\"\n            title=\"intellij-profile3\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span> 그래프 우클릭을 통해 해당 코드로 이동하거나 선택한 메소드를 기준으로 하위 메소드들만 <code class=\"language-text\">Call tree</code>, <code class=\"language-text\">Method List</code>을 볼 수가 있다.</p>\n<ol start=\"2\">\n<li>Call Tree</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 856px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/527bd6c0ca047bab552b80d193bd25c4/1712d/intellij-profiler4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlklEQVQoz3XRyXITMRDG8XkpDPEskjVaRrNIs3hsYyCESlEUJx4AJyFw46X/VBRy4MDhd2p166vuzDjPTttEGZdI/aRB1ub/lEa7ljYuie1i6stmbZj2B07n98zrkabrkbZHuki1qymlIq/kPwqxI68EwgXMeouarunOX+iXt2Sr0vTdkIbFec8474nTzDgvTMtKOwRq21DtNEI9S5+UgsoF6v0tcryme/eVYX8mG2vNoA1+iAwh0odIGKfEdwPaNSl1077okLWmqCqEG6iXT6j5Bn+4oQ0jmVaG/d+dGd9j2wHbBlwb2GlHKWsKobgqJdtyl+TieQ2iGdHrZ+T4ARtPKUB2tTzSnn8iDw+I9YI+XaiP31HHC9vlkTfzD15P92zGOzbxwibesRnveRUuVIdHzMffbMYH8vUXdv1G5voF5QaMjxgfUjrTzZh+Qbcz2o8I3ZKbidKtFDqyFZpcOgrlKaRlKyyl8uhmIHPeUxuDtg7nW0zjqX3A9DPavdQstbGI2lI9Xd8GCqkoKpGunVcVpZTpzR/cDCoPIw4e1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/527bd6c0ca047bab552b80d193bd25c4/24599/intellij-profiler4.webp 238w,\n/blog/static/527bd6c0ca047bab552b80d193bd25c4/69f92/intellij-profiler4.webp 475w,\n/blog/static/527bd6c0ca047bab552b80d193bd25c4/8d208/intellij-profiler4.webp 856w\"\n              sizes=\"(max-width: 856px) 100vw, 856px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/527bd6c0ca047bab552b80d193bd25c4/da2e6/intellij-profiler4.png 238w,\n/blog/static/527bd6c0ca047bab552b80d193bd25c4/abae4/intellij-profiler4.png 475w,\n/blog/static/527bd6c0ca047bab552b80d193bd25c4/1712d/intellij-profiler4.png 856w\"\n            sizes=\"(max-width: 856px) 100vw, 856px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/527bd6c0ca047bab552b80d193bd25c4/1712d/intellij-profiler4.png\"\n            alt=\"intellij-profile4\"\n            title=\"intellij-profile4\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n말 그대로 메소드에서 호출한 구조를 계층형으로 보여준다. 퍼센트 단위로 어느 구간에서 cpu를 많이 썻는지 직관적으로 확인이 가능하며 <code class=\"language-text\">Flame Graph</code>에서 원하는 메소드를 우클릭 -> <code class=\"language-text\">Focus on method in Call Tree</code>를 개인적으로 가장 많이 사용하고 있다.</p>\n<blockquote>\n<p>선택한 메소드를 기준으로 Call Tree를 보여준다</p>\n</blockquote>\n<p>그 외 항목들은 다 직관적이고 위 두 기능만 알면 얼추 감이 잡혀 써보면 바로 이해할 것이다.</p>\n<p>결과적으로 위 코드에선 List를 이중으로 순회하면서 값을 찾는 부분(<code class=\"language-text\">ArrayList.contains</code>)에서 가장 많은 리소스를 사용하고 있다. 이를 아래와 같이 <code class=\"language-text\">HashSet</code>을 사용하여 해시키 기반으로 찾도록 개선이 가능하다.</p>\n<blockquote>\n<p>해시키 기반으로 찾으므로 훨씬 더 효율적으로 검색이 가능하다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">countSameNumberUsingSet</span><span class=\"token punctuation\">(</span>first<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> seconds<span class=\"token operator\">:</span> List<span class=\"token operator\">&lt;</span>Int<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> secondsSet <span class=\"token operator\">=</span> seconds<span class=\"token punctuation\">.</span><span class=\"token function\">toHashSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">val</span> elapsed <span class=\"token operator\">=</span> measureTimeMillis <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">var</span> count <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>x <span class=\"token keyword\">in</span> first<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>x <span class=\"token keyword\">in</span> secondsSet<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                count<span class=\"token operator\">++</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"공통 숫자 개수=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">count</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"Set 걸린시간(ms)=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">elapsed</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>두 메소드들을 아래와 같이 병렬로 실행하고 결과를 보면</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> threadPool <span class=\"token operator\">=</span> Executors<span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">val</span> first <span class=\"token operator\">=</span> <span class=\"token function\">IntArray</span><span class=\"token punctuation\">(</span><span class=\"token number\">100_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> Random<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> seconds <span class=\"token operator\">=</span> <span class=\"token function\">IntArray</span><span class=\"token punctuation\">(</span><span class=\"token number\">50_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> Random<span class=\"token punctuation\">.</span><span class=\"token function\">nextInt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    threadPool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">countSameNumberUsingList</span><span class=\"token punctuation\">(</span>first<span class=\"token punctuation\">,</span> seconds<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    threadPool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">countSameNumberUsingSet</span><span class=\"token punctuation\">(</span>first<span class=\"token punctuation\">,</span> seconds<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    threadPool<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    threadPool<span class=\"token punctuation\">.</span><span class=\"token function\">awaitTermination</span><span class=\"token punctuation\">(</span><span class=\"token number\">30L</span><span class=\"token punctuation\">,</span> TimeUnit<span class=\"token punctuation\">.</span>SECONDS<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// Profiling started</span>\n<span class=\"token comment\">// 공통 숫자 개수=2</span>\n<span class=\"token comment\">// Set 걸린시간(ms)=7</span>\n<span class=\"token comment\">// 공통 숫자 개수=2</span>\n<span class=\"token comment\">// List 걸린시간(ms)=2458</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/38cdf4ef0018e9649dabec066e9a1ced/09504/intellij-profiler5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.29411764705882%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQoz23Py27CMBCF4TwWNBfP2LETSEggIApVkUBVJVTx/tu/Im0hgS6+heWZ4+MorT6wqy9MeyFtLoifI9ZhXCCxxUAgzpQ4kxFxOdYXZOpIjBItNu90uxNadqR5SyqOODODJTMg/dLfXfIQfhXNqppF05B7j3UOYx0v6TjgTgb0SR/48w29LYvzWF/iQomx/nfwP4/tboH3167N1AW69ZZu/cps3iAaUFfc2YCox2j+5Bo6CpymQlnknI8d5+Oaz8OS077isAnsV5a3zrFrhW2dsl1kT1SFKBk2zATnLMs6Z1l72iqnChlBp3iZ9IJO+vPYBK9TkiTmG+Fb+XV1HMEcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/38cdf4ef0018e9649dabec066e9a1ced/24599/intellij-profiler5.webp 238w,\n/blog/static/38cdf4ef0018e9649dabec066e9a1ced/69f92/intellij-profiler5.webp 475w,\n/blog/static/38cdf4ef0018e9649dabec066e9a1ced/cebde/intellij-profiler5.webp 950w,\n/blog/static/38cdf4ef0018e9649dabec066e9a1ced/53f84/intellij-profiler5.webp 1240w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/38cdf4ef0018e9649dabec066e9a1ced/da2e6/intellij-profiler5.png 238w,\n/blog/static/38cdf4ef0018e9649dabec066e9a1ced/abae4/intellij-profiler5.png 475w,\n/blog/static/38cdf4ef0018e9649dabec066e9a1ced/68327/intellij-profiler5.png 950w,\n/blog/static/38cdf4ef0018e9649dabec066e9a1ced/09504/intellij-profiler5.png 1240w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/38cdf4ef0018e9649dabec066e9a1ced/68327/intellij-profiler5.png\"\n            alt=\"intellij-profile5\"\n            title=\"intellij-profile5\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>오른쪽에 <code class=\"language-text\">pool-1-thread-1</code>, <code class=\"language-text\">pool-1-thread-2</code> 두 스레드 단위로 얼마나 리소스를 사용했는지 or 원하는 스레드만 선택하여 확인도 가능하다.</p>\n<blockquote>\n<p>단순 두 방법이 얼마나 큰차이가 생기는지만 보여주고 각 방법 별로 왜 개선 된 건지는 그냥 자료구조이므로 자세한 설명은 생략한다.</p>\n</blockquote>\n<h2 id=\"2-total-time-통한-병목지점-확인\" style=\"position:relative;\"><a href=\"#2-total-time-%ED%86%B5%ED%95%9C-%EB%B3%91%EB%AA%A9%EC%A7%80%EC%A0%90-%ED%99%95%EC%9D%B8\" aria-label=\"2 total time 통한 병목지점 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Total time 통한 병목지점 확인</h2>\n<p>또 다른 예시로 아래와 같은 전체코드가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">fun</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> increaseBySynchronized <span class=\"token operator\">=</span> <span class=\"token function\">IncreaseBySynchronized</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> increaseByLongAdder <span class=\"token operator\">=</span> <span class=\"token function\">IncreaseByLongAdder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token function\">incrementCheck</span><span class=\"token punctuation\">(</span>increaseBySynchronized<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">incrementCheck</span><span class=\"token punctuation\">(</span>increaseByLongAdder<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fun</span> <span class=\"token function\">incrementCheck</span><span class=\"token punctuation\">(</span>increaseTest<span class=\"token operator\">:</span> IncreaseTest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> threads <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n    <span class=\"token keyword\">val</span> pool <span class=\"token operator\">=</span> Executors<span class=\"token punctuation\">.</span><span class=\"token function\">newFixedThreadPool</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> latch <span class=\"token operator\">=</span> <span class=\"token function\">CountDownLatch</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">val</span> elapsed <span class=\"token operator\">=</span> measureTimeMillis <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span>threads<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            pool<span class=\"token punctuation\">.</span><span class=\"token function\">submit</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span><span class=\"token number\">2_000_000</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                    increaseTest<span class=\"token punctuation\">.</span><span class=\"token function\">increase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">}</span>\n                latch<span class=\"token punctuation\">.</span><span class=\"token function\">countDown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        latch<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    pool<span class=\"token punctuation\">.</span><span class=\"token function\">shutdown</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string-literal singleline\"><span class=\"token string\">\"counter=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">increaseTest<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, elapsed(ms)=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">$</span><span class=\"token expression\">elapsed</span></span><span class=\"token string\">, className=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token expression\">increaseTest<span class=\"token punctuation\">.</span>javaClass<span class=\"token punctuation\">.</span>simpleName</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> IncreaseTest <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token function\">increase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">fun</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Long\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> IncreaseBySynchronized <span class=\"token operator\">:</span> IncreaseTest <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> counter <span class=\"token operator\">=</span> <span class=\"token number\">0L</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">var</span> lock<span class=\"token operator\">:</span> Any <span class=\"token operator\">=</span> <span class=\"token function\">Any</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">increase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">synchronized</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            counter<span class=\"token operator\">++</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Long <span class=\"token operator\">=</span> counter\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> IncreaseByLongAdder <span class=\"token operator\">:</span> IncreaseTest <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">val</span> counter <span class=\"token operator\">=</span> <span class=\"token function\">LongAdder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">increase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        counter<span class=\"token punctuation\">.</span><span class=\"token function\">increment</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Long <span class=\"token operator\">=</span> counter<span class=\"token punctuation\">.</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// counter=20000000, elapsed(ms)=819, className=IncreaseBySynchronized</span>\n<span class=\"token comment\">// counter=20000000, elapsed(ms)=54, className=IncreaseByLongAdder</span></code></pre></div>\n<p>10개의 스레드가 동시에 공통변수의 숫자를 하나씩 2,000,000번 증가시키는 코드인데 thread safe를 보장하기 위해 첫번째 방법은 <code class=\"language-text\">synchronized</code>을 사용하고 두번째 방법은 <code class=\"language-text\">LongAdder</code>를 사용해서 thread safe를 보장하였다. 앞서 사용한 방식과 동일하게 <code class=\"language-text\">IntelliJ Profiler</code>를 돌리면 <code class=\"language-text\">Intellij</code> 코드에 아래와 같이 메소드별 걸린 시간도 표기해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 838px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/0591a/intellij-profiler9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.38655462184873%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACNUlEQVQ4y22S246jOBBA8w3zsOoE21xsjG0wEEg6aUgy0/Ow0kgrzcvs/3/KWUGzrentfSgjFXDquKp21lr+us58P1/QpqRtG+b5zO32zHy7cHq58Xx/5XJ/5TTdOU936hgpy5Ll3//GLkkSjm1HF1uUUhiTE6MnRrc+XdMS+hN1f6IdrzhXoxJJkgiklAghPsRugSRCsIBzbdFlhXMGHyp8tVg4TBUojGVfCJ6sRPiMosgRiVglfo/dUiWRAiEFKs3Q/sg4f2X6+o3zt5k4Xan7nn7oCUdPcw74oabuB4ytkPIjdJcqxbGsqHWJlAlKB9xxJnQjRVtjrwPtNHJ9XJgeD8ZxpCwKjPVrzxehD8C9SGiNpTElKlWozNB0Pffvr4zXifkx0zSOymq01gipOBwOyK1nC+R36G4KDT+PJy4uoNJ0TWaZwoWa8/XMnz9e+fnrF8PLM+PlyHDqMca8Qz4Z3urI36crc2gQSpKu0HStbkqDiYH+MRFfznTHhmFoqSqLEPLTQN6v/GX/xB/J4Q22WRZZRuYdOjhqp4m1Wwvt94cPV/1kuByDdcSlwUqxDMkGj609duvb+nGq/tfok+FyPDtPX9oVaBaA0eTO4r19G8SyxEJuiyzfzcQWy4D+za17+JQkHLZkWTnarmXoPF2sKYqCVG9R5GhdkGUZeZZR5Nn6Pi/0lkvfDNNNN89zKmdpu5rYeLqlf7VHdw1FHyljIMaALQ3RWZqqpA6e0I/YyhFKzT+lsHW0vxeUUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/24599/intellij-profiler9.webp 238w,\n/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/69f92/intellij-profiler9.webp 475w,\n/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/25dae/intellij-profiler9.webp 838w\"\n              sizes=\"(max-width: 838px) 100vw, 838px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/da2e6/intellij-profiler9.png 238w,\n/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/abae4/intellij-profiler9.png 475w,\n/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/0591a/intellij-profiler9.png 838w\"\n            sizes=\"(max-width: 838px) 100vw, 838px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/838d30ac3f8c1a714a4e4c907de1b73c/0591a/intellij-profiler9.png\"\n            alt=\"intellij-profile9\"\n            title=\"intellij-profile9\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>이 상태에서 화면 아래 우측에 <code class=\"language-text\">Show</code>를 Total Time으로 바꾸면 아래와 같이 출력 된다.</p>\n<h3 id=\"21-total-time---flame-graph\" style=\"position:relative;\"><a href=\"#21-total-time---flame-graph\" aria-label=\"21 total time   flame graph permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.1 total time - Flame Graph</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/64b545508b4399a0afe5173d1e4b04af/312cc/intellij-profiler6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.10924369747899%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQY053P2w7BQBAG4H0tPexRt9SZUqUHKcENesONePZf2rCIxIWLL7P5Z7KZIcwLYFP+N5dLKM+H0j4cJkBsl5lmFTzZFfriMP4gPufePh+FMYhFBSzKaw2HGpbLTW64v7ctNluQW7nA9RjVLvsBzrs+ztsuTrnCMRM4pAJlLrCOJFRT1idSob5U+bVMQIoswiqdocjmWKURlvMxkniCOOwhHGhMh36tencCH0xqSK8NpdumKh1Aei2sFx3cASuCtmbxta2eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/64b545508b4399a0afe5173d1e4b04af/24599/intellij-profiler6.webp 238w,\n/blog/static/64b545508b4399a0afe5173d1e4b04af/69f92/intellij-profiler6.webp 475w,\n/blog/static/64b545508b4399a0afe5173d1e4b04af/cebde/intellij-profiler6.webp 950w,\n/blog/static/64b545508b4399a0afe5173d1e4b04af/e457a/intellij-profiler6.webp 1182w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/64b545508b4399a0afe5173d1e4b04af/da2e6/intellij-profiler6.png 238w,\n/blog/static/64b545508b4399a0afe5173d1e4b04af/abae4/intellij-profiler6.png 475w,\n/blog/static/64b545508b4399a0afe5173d1e4b04af/68327/intellij-profiler6.png 950w,\n/blog/static/64b545508b4399a0afe5173d1e4b04af/312cc/intellij-profiler6.png 1182w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/64b545508b4399a0afe5173d1e4b04af/68327/intellij-profiler6.png\"\n            alt=\"intellij-profile6\"\n            title=\"intellij-profile6\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n메소드별 걸린 시간을 그래프로 표현</p>\n<h3 id=\"22-total-time---call-tree\" style=\"position:relative;\"><a href=\"#22-total-time---call-tree\" aria-label=\"22 total time   call tree permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.2 total time - Call Tree</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/f5766647e2eb95e5d571598428dabe29/cc5fa/intellij-profiler7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.39495798319328%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQoz22O607bQBgF/UhQ1JLE9t6v9jp2HJvSqu//GlNlAQFSfoy+PUfa0Wl0KpxM5FkYnoXlKF3lZ2/4VbHv92v+5Kg8nU3YPKHCQCOEJfiBsv9lXF+Ztj8M629cWdHpTGsTBxU5qMBBR55azeNR8Xh64+Eg+dFZ+vM/zLDQOOMY88CyXrluO+u2M5aC8QkdCtJGhDIIpe8jFdI4ehvxKdM4F4h5JOSROBRiLthYkPGMiCudzbRS0wp1h7e+045TrzA+0hjrmaaZ7eWVdX9hmGZ8ntAu0ClDVz9KOqnru3uX1Sw/ha00uJBobnNTHpmWC8u6MV+uzOvOdNnqaj8uCBu+Sb5Se2XrWntbeBPakGrwMWNDxKQZE0tdKVymd4VO+7vSj+52lXH8B6Af+Zi9weB9AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/f5766647e2eb95e5d571598428dabe29/24599/intellij-profiler7.webp 238w,\n/blog/static/f5766647e2eb95e5d571598428dabe29/69f92/intellij-profiler7.webp 475w,\n/blog/static/f5766647e2eb95e5d571598428dabe29/cebde/intellij-profiler7.webp 950w,\n/blog/static/f5766647e2eb95e5d571598428dabe29/145c7/intellij-profiler7.webp 1188w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/f5766647e2eb95e5d571598428dabe29/da2e6/intellij-profiler7.png 238w,\n/blog/static/f5766647e2eb95e5d571598428dabe29/abae4/intellij-profiler7.png 475w,\n/blog/static/f5766647e2eb95e5d571598428dabe29/68327/intellij-profiler7.png 950w,\n/blog/static/f5766647e2eb95e5d571598428dabe29/cc5fa/intellij-profiler7.png 1188w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/f5766647e2eb95e5d571598428dabe29/68327/intellij-profiler7.png\"\n            alt=\"intellij-profile7\"\n            title=\"intellij-profile7\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n메소드별 걸린 시간을 계층 구조로 표현</p>\n<h3 id=\"23-total-time---method-list\" style=\"position:relative;\"><a href=\"#23-total-time---method-list\" aria-label=\"23 total time   method list permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2.3 total time - Method List</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/e0ecf7c36a611d1092fe22a117356899/08158/intellij-profiler8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.907563025210084%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvUlEQVQY02XP7W6CQBCFYa6rwjK7y36BqBUiIIT0/m/ibVy1adofT85kkjPJFDb2VGKystZUD/Irf2bzT60tMbWkrqfxEbENxXRfGaeF8bYQ2h7jY2Z9yt6zbgJiPdK8WI/2LaYbSKcBk86E4yfFtn8xLSvzurFsO8Nt5nwd6U4X7OO4CzmVtvmDsjZPSqhsRNKVcLxQikW7SHHfdsZpJnZ9LruQEOty+aBqPqqng5I/akrjUa7FxTbvlBi+Aa20kUO8f/kQAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/blog/static/e0ecf7c36a611d1092fe22a117356899/24599/intellij-profiler8.webp 238w,\n/blog/static/e0ecf7c36a611d1092fe22a117356899/69f92/intellij-profiler8.webp 475w,\n/blog/static/e0ecf7c36a611d1092fe22a117356899/cebde/intellij-profiler8.webp 950w,\n/blog/static/e0ecf7c36a611d1092fe22a117356899/632a5/intellij-profiler8.webp 1195w\"\n              sizes=\"(max-width: 950px) 100vw, 950px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/blog/static/e0ecf7c36a611d1092fe22a117356899/da2e6/intellij-profiler8.png 238w,\n/blog/static/e0ecf7c36a611d1092fe22a117356899/abae4/intellij-profiler8.png 475w,\n/blog/static/e0ecf7c36a611d1092fe22a117356899/68327/intellij-profiler8.png 950w,\n/blog/static/e0ecf7c36a611d1092fe22a117356899/08158/intellij-profiler8.png 1195w\"\n            sizes=\"(max-width: 950px) 100vw, 950px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/blog/static/e0ecf7c36a611d1092fe22a117356899/68327/intellij-profiler8.png\"\n            alt=\"intellij-profile8\"\n            title=\"intellij-profile8\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n메소드별 걸린 시간을 표현(한번 메소드 이름으로 정렬하였다)</p>\n<p>이런식으로 두가지 방법(<code class=\"language-text\">synchronized</code>, <code class=\"language-text\">LongAdder</code>)을 그래프, call tree, 메소드별 걸린 시간을 구간구간 확인하여 개선 포인트를 찾는게 훨씬 쉬워진다.</p>\n<hr>\n<p><code class=\"language-text\">IntelliJ Profiler</code>를 사용해서 대표적으로 <code class=\"language-text\">cpu 사용시간</code>/<code class=\"language-text\">total time</code>을 프로파일링하여 하나씩 확인하였다.</p>\n<p>하지만 실제 운영 환경에서 고려해야 할 점은 사실 서버는 cpu를 많이 안쓴다는 점이다. 설명한 예시 두개 다 외부 연동없이 java 코드만 돌리는 것이라 <code class=\"language-text\">total time</code>이 <code class=\"language-text\">cpu time</code>과 크게 연관 있지만 서버에선 <code class=\"language-text\">DB</code>, 외부 api, <code class=\"language-text\">redis</code> 등등 요청하고 대기하는 로직이 많아 실제 cpu는 얼마 안쓰는데 걸린시간은 길 수도 있고, 아님 <code class=\"language-text\">GC</code> 오버헤드로 인해 엉뚱한 곳에서 <code class=\"language-text\">total time</code>이 크게 늘어 날 수도 있다.</p>\n<blockquote>\n<p>서버에서 cpu를 과도하게 많이 사용된다면 먼저 파일처리, GC 퍼포먼스를 의심해보자</p>\n</blockquote>\n<p>마지막으로 <code class=\"language-text\">Spring</code>을 쓰면 상상 이상으로 <code class=\"language-text\">call stack</code>이 길어 질 수 있는데 어차피 다 자바 코드이고 하나씩 천천히 따라가면 다 똑같으니 괜히 겁먹을 필요는 없다.</p>","fields":{"slug":"/posts/java/java-async-profiler/","tagSlugs":["/tag/java/","/tag/profiler/"]},"frontmatter":{"date":"2025-12-30T14:57:49.541Z","description":"IntelliJ에서 Async Profiler(IntelliJ Profiler)를 통한 성능 측정","tags":["java","profiler"],"title":"IntelliJ Async Profiler","socialImage":null}}},"pageContext":{"slug":"/posts/java/java-async-profiler/"}},"staticQueryHashes":["251939775","2839666046","2891173899","401334301"]}