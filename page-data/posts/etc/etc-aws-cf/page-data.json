{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/etc/etc-aws-cf/","result":{"data":{"markdownRemark":{"id":"a4df36e4-49da-5ba2-ae39-c4995c707e1e","html":"<h1 id=\"cloudfront\" style=\"position:relative;\"><a href=\"#cloudfront\" aria-label=\"cloudfront permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CloudFront</h1>\n<p>정적 리소스들을 전 세계를 대상으로 빠르게 제공해주는 CDN 서버</p>\n<p>일반적으로 정적 리소드들을 <code class=\"language-text\">S3</code>에 올려놓고 <code class=\"language-text\">CloudFront</code>를 <code class=\"language-text\">S3</code>에 연결하여 사용을 한다. 순수 정적 컨텐츠를 위한 CDN 서버 셋팅은 <code class=\"language-text\">S3</code>랑 연동하는 하면 끝이라 여기서 +@로 웹서버까지 구현하는게 목표</p>\n<hr>\n<h2 id=\"정적-웹서버-구현-feat-cra\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EC%A0%81-%EC%9B%B9%EC%84%9C%EB%B2%84-%EA%B5%AC%ED%98%84-feat-cra\" aria-label=\"정적 웹서버 구현 feat cra permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정적 웹서버 구현 feat. CRA</h2>\n<p>기술 스택</p>\n<ul>\n<li>S3</li>\n<li>\n<p>CloudFront</p>\n<ol>\n<li>OAI</li>\n</ol>\n</li>\n<li>CRA</li>\n</ul>\n<p><code class=\"language-text\">route53</code>도 사용하고 싶지만, 보유한 도메인도 없고 돈도 없어서 생략</p>\n<p>선행 작업으로 <code class=\"language-text\">s3</code>에 <code class=\"language-text\">bucket</code>을 만들고, <code class=\"language-text\">퍼블릭 엑세스 차단</code> <strong>활성화</strong>, <code class=\"language-text\">CRA</code>로 만든 빌드 파일을 해당 <code class=\"language-text\">bucket</code>에 업로드</p>\n<h3 id=\"1-cloud-front-주요-설정값\" style=\"position:relative;\"><a href=\"#1-cloud-front-%EC%A3%BC%EC%9A%94-%EC%84%A4%EC%A0%95%EA%B0%92\" aria-label=\"1 cloud front 주요 설정값 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Cloud Front 주요 설정값</h3>\n<ul>\n<li>\n<p>Origin Domain Name</p>\n<p>Domain 주소값을 입력 할 수 있으나 s3를 통해 Resource를 제공 해줄 것이므로 dropDown에 나타나는 bucket중, 원하는 버켓을 선택한다. <strong>주의!</strong> 이때, <code class=\"language-text\">{버킷명}.s3.{리전}.amazonaws.com</code>형태로 리전 값을 넣어야 한다. 안넣고 최초 배포 시, DNS에서 실제 주소 값을 찾아가 리소스를 활성화 하는데 오래 걸릴 수가 있다. 시간이 지나면 해결 되지만 리전값 넣는게 어려운것도 아니므로 왠만하면 그냥 넣어준다.</p>\n</li>\n<li>\n<p>Restrict Bucket Access(버킷 access 제한)</p>\n<p>CloudFront를 통해서만 버킷 접근을 허용 할지 여부. <code class=\"language-text\">예</code>를 선택하면 <code class=\"language-text\">OAI</code> 선택 창이 보이는데, 경우에 따라 새로운 <code class=\"language-text\">OAI</code> 생성 또는 기존 <code class=\"language-text\">OAI</code>를 사용 선택</p>\n</li>\n<li>\n<p>Grant Read Permissions on Bucket</p>\n<p>CloudFront가 원본(s3)에 접근 권한을 자동으로 부여 할지 여부. 그냥 yes</p>\n</li>\n<li>\n<p>Viewer Protocol Policy</p>\n<p>접근 허용할 프로토콜을 선택하는건데 http는 속도 느리고 보안적으로도 안좋으니까 https를 통해서만 접근하는게 좋다. 경우에 따라(보통 다른 앱) http로 접근 할 수도 있으므로 http로 접근 시 https로 Redirect 되도록 설정(<code class=\"language-text\">Redirect Http to Https</code>)</p>\n</li>\n<li>\n<p>Allowed HTTP Methods</p>\n<p>정적 웹서버를 만드는게 목표니까 <code class=\"language-text\">GET, HEAD</code>로만 설정해도 충분. 필요 시, 다른걸로 설정해도 상관없다.</p>\n</li>\n<li>\n<p>TTL</p>\n<p>캐싱 기간을 무한히 가져가면 만약 s3에 기존 파일을 업데이트 해도 업데이트 된 파일을 확인이 불가능하다. 그래서 캐싱된 기간을 제어하려고 만든건데 개인적으로 그냥 디폴트 값으로 쓰다가 필요 시 CloudFront의 캐싱을 날려버리는 기능을 많이 쓴다.</p>\n</li>\n<li>\n<p>Restrict Viewer Access</p>\n<p>서명된 URL만 접근을 허용할지 여부. 접근 제한이 필요하다면 <code class=\"language-text\">Yes</code> 아니면 <code class=\"language-text\">No</code>로 하면 되고, 현재는 접근 제한없이 public하게 만드는게 목적이니까 <code class=\"language-text\">NO</code>. 당연히 yes를 선택하면 추가적인 정보가 있어야 하고, 요청 URL에 파라미터를 많이 셋팅해서 사용해야한다.</p>\n</li>\n<li>\n<p>Compress Objects Automatically</p>\n<p>압축이 가능한 형태의 리소스라면 압축해서 제공할지 여부 선택. 그냥 yes로 하는게 좋다고 한다.</p>\n</li>\n<li>\n<p>Price Class</p>\n<p>사용할 엣지 로케이션을 선택하는건데 뭐 전세계를 대상으로 서비스 할꺼면 모든 곳에 배포하면 좋지만 그러면 배포 시간도 오래걸리고 돈도 많이 나간다고 한다. 국내만 서비스 할것이냐 아니냐에 따라 선택하면 된다.</p>\n</li>\n<li>\n<p>Supported HTTP Versions</p>\n<p>그냥 HTTP/2 선택. 만약 3버전도 서비스 해준다면 그때 3으로 선택할지를 고려</p>\n</li>\n<li>\n<p>Default Root Object</p>\n<p>기본 접근 파일. cra로 만들어져 모든 접근 파일인 <code class=\"language-text\">index.html</code>로 입력</p>\n</li>\n</ul>\n<p>필요한 설정을 완료 하고 <code class=\"language-text\">Create Distribution</code> 클릭 하면 완료된다.</p>\n<h3 id=\"2-라우팅-설정에러페이지-셋팅\" style=\"position:relative;\"><a href=\"#2-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%84%A4%EC%A0%95%EC%97%90%EB%9F%AC%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%85%8B%ED%8C%85\" aria-label=\"2 라우팅 설정에러페이지 셋팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 라우팅 설정(에러페이지 셋팅)</h3>\n<p>위 내용까지 셋팅하면 <code class=\"language-text\">CloudFront</code>에서 제공해주는 도메인으로 <code class=\"language-text\">S3</code>에 존재하는 하위 디렉토리 및 파일들을 찾아가도록 셋팅한 것이다. 근데 우리는 <code class=\"language-text\">React App</code>이니까 <code class=\"language-text\">URL</code>의 주소가 어찌되어 있던 <code class=\"language-text\">index.html</code>로 접근하여 <code class=\"language-text\">React</code>레벨에서 라우팅 처리가 되도록 셋팅해야 한다.</p>\n<p>생성된 <code class=\"language-text\">Cloud Front</code>를 선택 -> <code class=\"language-text\">Error Pages</code>를 클릭하면 에러 페이지 셋팅이 가능하고, <code class=\"language-text\">403</code>, <code class=\"language-text\">404</code>일때 <code class=\"language-text\">/index.html</code>로 보내 어플리케이션 레벨에서 모든 처리가 이루어 지도록 셋팅하면 된다.</p>\n<table>\n<thead>\n<tr>\n<th>HTTP Error Code</th>\n<th>Response Page Path</th>\n<th>Http Response Code</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>403</td>\n<td>/index.html</td>\n<td>200</td>\n</tr>\n<tr>\n<td>404</td>\n<td>/index.html</td>\n<td>200</td>\n</tr>\n</tbody>\n</table>\n<p>이런식으로 셋팅하면 어플리케이션 레벨(<code class=\"language-text\">React</code>)에서 모든 라우팅 처리를 맡기게 셋팅된다.\n캐싱 기간은 디폴트값으로 사용해도 충분할꺼라 생각된다.</p>\n<h3 id=\"3-정리\" style=\"position:relative;\"><a href=\"#3-%EC%A0%95%EB%A6%AC\" aria-label=\"3 정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 정리</h3>\n<p>이렇게 까지 셋팅해야 보다 안전하고 빠른 웹서버 구축이 된다. 중요한 부분을 몇가지 다시 생각해보면</p>\n<h4 id=\"31-외부에서-s3-접근-불가\" style=\"position:relative;\"><a href=\"#31-%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-s3-%EC%A0%91%EA%B7%BC-%EB%B6%88%EA%B0%80\" aria-label=\"31 외부에서 s3 접근 불가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1 외부에서 S3 접근 불가</h4>\n<p>처음 <code class=\"language-text\">S3</code>를 만들 때 <code class=\"language-text\">퍼블릭 엑세스 차단</code>을 체크하였고, <code class=\"language-text\">S3</code>에서 <code class=\"language-text\">정적 웹 사이트 호스팅</code> 또한 하지 않았다. 따라서 외부에서 <code class=\"language-text\">S3</code>에 직접 접근 할 수도, 버킷명도 알아낼 방법이 없어 보안적으로 좋아진다.</p>\n<h4 id=\"32-ssl-적용이-쉽다\" style=\"position:relative;\"><a href=\"#32-ssl-%EC%A0%81%EC%9A%A9%EC%9D%B4-%EC%89%BD%EB%8B%A4\" aria-label=\"32 ssl 적용이 쉽다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2 SSL 적용이 쉽다</h4>\n<p><code class=\"language-text\">Cloud Front</code>를 사용함으로써 기본적으로 SSL 사용이 쉽게 셋팅이 된다\n정적 웹서버 호스팅은 aws 내에서도 여러가지 방법이 존재하긴 한다.</p>\n<ol>\n<li>S3에서 <code class=\"language-text\">정적 웹 사이트 호스팅</code></li>\n<li><code class=\"language-text\">route53</code>에서 S3로 직접 연결</li>\n</ol>\n<p>이런 방법들이 있긴 하지만 SSL 적용을 이보다 편하게 할 수는 없는걸로 알고 있다.</p>\n<h4 id=\"33-모든-라우팅-처리는-어플리케이션-레벨\" style=\"position:relative;\"><a href=\"#33-%EB%AA%A8%EB%93%A0-%EB%9D%BC%EC%9A%B0%ED%8C%85-%EC%B2%98%EB%A6%AC%EB%8A%94-%EC%96%B4%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98-%EB%A0%88%EB%B2%A8\" aria-label=\"33 모든 라우팅 처리는 어플리케이션 레벨 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.3 모든 라우팅 처리는 어플리케이션 레벨</h4>\n<p>CDN 서버 입장해선 접근 시 무조건 index.html로 보내게 된다(<code class=\"language-text\">/</code>, <code class=\"language-text\">403</code>, <code class=\"language-text\">404</code> 한정).</p>\n<h4 id=\"34-웹서버-관리가-필요없다\" style=\"position:relative;\"><a href=\"#34-%EC%9B%B9%EC%84%9C%EB%B2%84-%EA%B4%80%EB%A6%AC%EA%B0%80-%ED%95%84%EC%9A%94%EC%97%86%EB%8B%A4\" aria-label=\"34 웹서버 관리가 필요없다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.4 웹서버 관리가 필요없다.</h4>\n<p>내가 직접 웹서버를 구축하고 관리하는게 아니라 다 aws에서 관리해주니까 성능, 관리 측면에서 엄청난 이득이다.</p>","fields":{"slug":"/posts/etc/etc-aws-cf/","tagSlugs":["/tag/aws/","/tag/cloudfront/","/tag/cdn/","/tag/web-server/","/tag/infra/"]},"frontmatter":{"date":"2020-07-21T02:10:43.331Z","description":"CDN 서버 구축 & 쉽게 웹서버를 구축하고 싶을 떄","tags":["aws","cloudfront","cdn","web server","infra"],"title":"AWS - Cloud Front","socialImage":null}}},"pageContext":{"slug":"/posts/etc/etc-aws-cf/"}}}