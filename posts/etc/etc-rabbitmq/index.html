<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blog/styles.a35a10275142a9761538.css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-bottom:1.625rem}h1,h2{margin-top:2.4375rem}h2{font-size:1.6875rem;line-height:2.4375rem;margin-bottom:.8125rem}h3{font-size:1.375rem}h3,h4{line-height:1.625rem;margin-top:1.625rem;margin-bottom:.8125rem}h4{font-size:1.2rem}h5,h6{font-size:1rem;line-height:1.625rem;margin-top:4.0625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;border-left:5px solid #39f}blockquote>p{padding-left:.9375rem}blockquote>p>code[class*=language-]{overflow-wrap:break-word}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}body :not(pre)>code.language-text{background-color:rgba(27,31,35,.05);color:#000;max-width:100%;display:inline-block;white-space:inherit}body :not(pre)>code.language-text::-moz-selection{background-color:#d2d8fb}body :not(pre)>code.language-text::selection{background-color:#d2d8fb}body code[class*=language-],body pre[class*=language-]{background-color:#000;color:#dcdcdc}body code[class*=language-] ::-moz-selection,body pre[class*=language-] ::-moz-selection{background-color:#d2d8fb;color:#fff}body code[class*=language-] ::selection,body pre[class*=language-] ::selection{background-color:#d2d8fb;color:#fff}body .token.atrule,body .token.attr-value,body .token.keyword{color:#39f}body .token.punctuation{color:#dcdcdc}table{width:100%;border-top:1px solid #444;border-collapse:collapse}td,th{border-bottom:1px solid #444;padding:.625rem;text-align:center}a{overflow-wrap:break-word}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#073642}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.SideButton-module--sides--BtKaf{margin-bottom:1.625rem}.SideButton-module--sides-button--1ZBs9{color:#222;background-color:#fff;padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:3.125rem;width:3.125rem;line-height:3.125rem;border-radius:50%;text-align:center;border:1px solid #ebebeb;position:fixed;right:15px;bottom:10px;cursor:pointer;transition:all .5s ease-in-out}.SideButton-module--sides-button--1ZBs9:focus,.SideButton-module--sides-button--1ZBs9:hover{color:#5d93ff}.SideButton-module--sides-button-hide--1UbTc{bottom:-120px!important}@media screen and (min-width:960px){.SideButton-module--sides-button--1ZBs9{right:10px;bottom:100px;right:70px}}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:-webkit-gradient(linear,left top,left bottom,from(#e6e6e6),color-stop(48%,#e6e6e6),to(#fff));background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(24.975% - 1.40625rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(4n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(4n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:75rem;margin-left:auto;margin-right:auto;position:relative}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Layout-module--layout-doc-mask--1C0nh{height:30%;top:70%;position:absolute}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Tag-module--tags--BftwU{display:flex;flex-wrap:wrap;gap:11px 20px}.Tag-module--tags__tag--3mcZ8{background:#f1f3f5;border-radius:1.25rem;color:#0ca678;cursor:pointer;display:inline-flex;height:2.1875rem;align-items:center;padding:0 .625rem}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Skills-module--skills-layout__home-button--1bbks{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Skills-module--skills-layout__home-button--1bbks:focus,.Skills-module--skills-layout__home-button--1bbks:hover{color:#5d93ff}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb{display:grid;grid-column-gap:3px;grid-template-columns:none;grid-row-gap:2px}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb .Skills-module--skills--DoUk5{padding-left:1.5625rem;align-items:center;margin-bottom:.9375rem;border-left:1px solid #e1e1e1}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb .Skills-module--skills__header--3r4Bx{color:#5d686f;margin-top:.3125rem;display:block}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb .Skills-module--skills--DoUk5 ul li{margin-left:1.875rem;list-style-type:disc;margin-bottom:.125rem}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb .Skills-module--skills--DoUk5 ul li span{color:#5d686f}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb .Skills-module--skills__subtitle--1GDjF{margin:0;color:#5d686f}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb .Skills-module--skills__subtitle--1GDjF:not(:first-child){margin-top:0}@media screen and (min-width:960px){.Skills-module--skills-layout__home-button--1bbks{position:fixed;max-width:auto;margin:0;top:30px;left:30px}.Skills-module--skills-layout--4EPsm .Skills-module--skills-wrap--35Dzb{grid-template-columns:repeat(3,1fr)}}.Content-module--content--2fUDt{max-width:68.75rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--3jCCL{font-size:2rem;max-width:59.375rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--16rY1 figure{margin-bottom:1.625rem}.Content-module--content__body--16rY1 figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--16rY1 figure blockquote p{max-width:59.375rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--16rY1 a{text-decoration:underline}.Content-module--content__body--16rY1 *{max-width:59.375rem;margin-left:auto;margin-right:auto}.Content-module--content__body--16rY1 img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--2fUDt{padding:0}.Content-module--content__title--3jCCL{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--16rY1,.Content-module--content__body--16rY1 p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:59.375rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:68.75rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:59.375rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:59.375rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:59.375rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}.Content-module--content__body--2TrQ- ul{margin-left:1.25rem;padding-left:.3125rem}.Content-module--content__body--2TrQ- ul ul{margin-left:.3125rem}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.Content-module--content__body--2TrQ- ul>li>p{margin-bottom:0}.Content-module--content__body--2TrQ- ul{margin-left:auto;padding-left:2.5rem}.Content-module--content__body--2TrQ- ul ul{margin-left:auto}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:59.375rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.20.12"/><link rel="alternate" type="application/rss+xml" title="Blog by joohyung" href="/blog/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id="></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', '', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/blog/sitemap.xml"/><link rel="manifest" href="/blog/manifest.webmanifest"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/blog/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/blog/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/blog/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/blog/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/blog/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/blog/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/blog/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/blog/icons/icon-512x512.png"/><title data-react-helmet="true">RabbitMQ - Blog by joohyung</title><meta data-react-helmet="true" name="description" content="메세지 큐를 사용하는 이유 및 사용 방법. with RabbitMQ"/><meta data-react-helmet="true" property="og:site_name" content="RabbitMQ - Blog by joohyung"/><link as="script" rel="preload" href="/blog/webpack-runtime-a1a700d2a6e364f766c0.js"/><link as="script" rel="preload" href="/blog/framework-99708135f20a48422ed8.js"/><link as="script" rel="preload" href="/blog/532a2f07-1d2a7bbc1a68ccd5edd4.js"/><link as="script" rel="preload" href="/blog/app-ddd22c35447b94046b82.js"/><link as="script" rel="preload" href="/blog/styles-083a06cb5740baaf347d.js"/><link as="script" rel="preload" href="/blog/b85ce96f5d2f4665e19992ddb57b3614f7b5719c-5e70df081ad36bfd606c.js"/><link as="script" rel="preload" href="/blog/d4f3f45f3b97a996ebac05174393e9dafe15c3a1-4deb2450f60e37cf9a36.js"/><link as="script" rel="preload" href="/blog/component---src-templates-post-template-js-17e06f3db6dffdc0abe9.js"/><link as="fetch" rel="preload" href="/blog/page-data/posts/etc/etc-rabbitmq/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/blog/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/blog/">전체</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">RabbitMQ</h1><div class="Content-module--content__body--2TrQ-"><h1 id="rabbitmq" style="position:relative;"><a href="#rabbitmq" aria-label="rabbitmq permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>RabbitMQ.</h1>
<p>메세지 큐 중 하나로 대표적으로 kafka, rabbitmq가 있지만 여기선 rabbitmq 위주로 설명할 예정</p>
<p>여기서 설명할 내용 및 샘플은 <a href="https://github.com/qweasd147/StudyNote/tree/master/springboot/rabbitmq" target="_blank" rel="nofollow noopener noreferrer">rabbitmq-sample</a> 여기서 확인 가능</p>
<h1 id="1-메세지-큐" style="position:relative;"><a href="#1-%EB%A9%94%EC%84%B8%EC%A7%80-%ED%81%90" aria-label="1 메세지 큐 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 메세지 큐</h1>
<p>여러 어플리케이션에서 메세지를 주고 받는 시스템. 간단히 설명하면 일종의 DB를 외부에 두고 여러 어플리케이션에서 해당 DB에 데이터를 교환하는 시스템이다.
일종의 DB라고 설명했지만 DB와 큰 차이점은 각 메세지를 주고받는데 목적이 있고, 내부 처리 방식은 전혀 다른 점이다.
메세지 큐를 사용할 수도 있는 곳을 예를 들면 대용량 알림 시스템이다. 예를 들어 10만명의 사용자한테 이메일을 보내야 한다고 가정할때 메세지 큐를 사용 안한다면 대략적으로 다음과 같은 플로우를 거쳐야 할 것이다.</p>
<ol>
<li>DB에서 사용자 정보 조회 및 변수에 저장</li>
<li>이메일 대상 필터링(validation 포함)</li>
<li>이메일 발송</li>
</ol>
<p>이러한 작업은 주기적으로 cron이 돌면서 처리해야할 정보가 있나 체크도 해야할 것이며(감시해야하는 프로세스가 주기적으로 돌고 있어야됨), <code class="language-text">3. 이메일 발송</code>은 뭐 자바를 기준으로 <code class="language-text">java 8의 Stream</code>기반으로 처리하던가 푸시 기반인 <code class="language-text">RxJava</code>등을 사용 할 수도 있을 것이다. 하지만 결국 문제는 이 모든 작업이 하나의 어플리케이션에서 수행이 된다는 점이다.</p>
<p>만약 처리중 예상하지 못한 에러가 발생한다면? 뭐 <code class="language-text">RxJava</code>에서는 알림을 받을 수도 있을 것이다. 그럼 만약 너무 많은 데이터를 어플리케이션에 담고 있어서 처리 중간에 그냥 어플이 죽어버렸다면? 어플이야 다시 복구 하면 되지만 중간에 처리되던 과정들은 통째로 다 날라가게 된다. 2번 과정을 거의다 끝내고 3번이 남았는데 다시 1번 부터 수행해야 할것이고, 더 큰 문제는 많은 사용자들이 메일을 중복해서 받을 수도 있다는 점이다.</p>
<p>이러한 점을 봤을때 메세지큐를 사용함으로써 생기는 이득은 아래와 같다.</p>
<ol>
<li>기본적으로 구독형 방식(폴링 방식x)</li>
<li>메세지(ex. 처리해야할 정보)를 외부에 저장</li>
<li>일단 큐에 담고 비동기로 처리 가능</li>
<li>여러 어플리케이션에서 처리 또는 consumer 개수 증가 등의 확장이 쉬움(분산 처리 가능)</li>
<li>재처리 및 실패 처리가 쉬움</li>
</ol>
<h1 id="2-기본-용어" style="position:relative;"><a href="#2-%EA%B8%B0%EB%B3%B8-%EC%9A%A9%EC%96%B4" aria-label="2 기본 용어 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 기본 용어</h1>
<h3 id="21-queue" style="position:relative;"><a href="#21-queue" aria-label="21 queue permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.1 Queue</h3>
<p>메세지를 담는 큐</p>
<h3 id="22-exchange" style="position:relative;"><a href="#22-exchange" aria-label="22 exchange permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.2 Exchange</h3>
<p>메세지를 받아 어느 큐로 옮길지 정한다. Exchange 종류에 따라 똑같은 <code class="language-text">Routing Key</code>라도 다른 큐에 담길 수 있다.</p>
<h3 id="23-binding" style="position:relative;"><a href="#23-binding" aria-label="23 binding permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.3 Binding</h3>
<p>exchange와 queue를 연동(실질적인 Routing key 패턴과 exchange를 연동)</p>
<p><strong>참고</strong> 메세지는 생성 후 바로 큐로 옮기는게 아닌, <code class="language-text">Exchange</code>를 한번 거쳐서 전달된다. <code class="language-text">Exchange</code> 종류와 <code class="language-text">Binding</code>에 따라 큐가 결정 &#x26; 전달한다.</p>
<h3 id="24-routing-key" style="position:relative;"><a href="#24-routing-key" aria-label="24 routing key permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.4 Routing Key</h3>
<p>가상 주소로, 라우팅 시 필요한 key값이다.
예를 들어 ’<code class="language-text">Routing Key</code>값이 <code class="language-text">r1</code>이면 <code class="language-text">Exchange1</code>로 가라’ 이런식으로 라우팅 하는데 사용</p>
<h1 id="3-dlxdead-latter-exchanges" style="position:relative;"><a href="#3-dlxdead-latter-exchanges" aria-label="3 dlxdead latter exchanges permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. DLX(Dead Latter Exchanges)</h1>
<blockquote>
<p>메세지 처리 과정에서 에러가 발생한 메세지를 관리할 exchange</p>
</blockquote>
<p>만약 메세지를 처리 중 에러가 발생하는 경우가 발생 할 수도 있다.<code class="language-text">RabbitMQ</code>의 기본 셋팅은 메세지 처리중 에러가 발생하면 다시 큐로 집어넣고 다시 메세지 처리를 시도하게 된다.
근데 만약 절대 처리할 수 없는 메세지라면? 재처리 과정이 무한하게 반복될 것이다. 이런 케이스를 막기위해 만약 에러가 발생한다면 아래와 같이 처리되도록 유도한다.</p>
<ol>
<li>메세지 처리 중 에러 발생</li>
<li>n번 재시도</li>
<li>그래도 실패 시, 처리가 불가능 한 메세지라 판단하고 DLX로 보냄</li>
<li>실패 전용 큐로 해당 메세지로 보낸 후 처리</li>
</ol>
<p>메세지 처리 시도 회수와 dlx 정보는 메세지의 헤더에 담겨지고, <code class="language-text">DLX</code>에서 이러한 메세지들을 처리할 목적의 큐로 보내도록 셋팅해놓는다.
보통 이러한 메세지는 메세지 정보와 알림 정보만 개발자에게 알려주도록 셋팅한다(정상적인 처리가 불가능하니까).</p>
<h2 id="31-ttltime-to-live" style="position:relative;"><a href="#31-ttltime-to-live" aria-label="31 ttltime to live permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.1 TTL(Time to live)</h2>
<p><code class="language-text">TTL</code>은 큐에 머무를 수 있는 시간을 제한하는 것으로, 너무 오래된 큐를 방치하는것을 막을 수 있다.</p>
<p><code class="language-text">Spring Boot</code> + <code class="language-text">RabbitMQ</code> 조합에선 큐를 정의할 때 아래와 같이 쉽게 셋팅이 가능하다.</p>
<p>큐 셋팅</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"x-dead-letter-exchange"</span><span class="token punctuation">,</span> <span class="token string">"dlx exchange 이름"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"x-dead-letter-routing-key"</span><span class="token punctuation">,</span> <span class="token string">"실패 라우팅 키"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"x-message-ttl"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2초</span>

      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>위와 같이 셋팅 시, ttl(Time to Live)값을 넘기는 메세지는 <code class="language-text">DLX(dlx exchange 이름)</code>로 보내지게 된다.</p>
<h2 id="32-retry-interceptor" style="position:relative;"><a href="#32-retry-interceptor" aria-label="32 retry interceptor permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.2 retry interceptor</h2>
<p><code class="language-text">TTL</code>에 의해 발생되는 에러 말고 메세지를 처리하다가 발생하는 에러 셋팅을 하고 싶으면 <code class="language-text">RetryInterceptor</code>를 구현해서 리스너에 셋팅하면 된다.
(근데 <code class="language-text">Message Queue</code>전체로 봤을땐 그냥 <code class="language-text">exchange</code>랑 <code class="language-text">routing-key</code>만 바꿔서 셋팅하는거다)</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span> <span class="token function">listenerContainerFactory</span><span class="token punctuation">(</span><span class="token class-name">ConnectionFactory</span> connectionFactory<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword">final</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleRabbitListenerContainerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setDefaultRequeueRejected</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setMessageConverter</span><span class="token punctuation">(</span><span class="token function">messageConverter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setChannelTransacted</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setAdviceChain</span><span class="token punctuation">(</span><span class="token class-name">RetryInterceptorBuilder</span>
            <span class="token punctuation">.</span><span class="token function">stateless</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">maxAttempts</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment">//.recoverer(new RepublishMessageRecoverer(rabbitTemplate, "에러용 exchange 이름", "실패 큐 이름"))</span>
            <span class="token punctuation">.</span><span class="token function">recoverer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RabbitMqExceptionHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">backOffOptions</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> factory<span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>위 셋팅 처럼 실패 시 재시도 횟수(<code class="language-text">maxAttempts</code>) 및 재시도 간격(<code class="language-text">backOffOptions</code>)을 정의 할 수 있고, 실질적인 메세지 실패 처리는 <code class="language-text">RejectAndDontRequeueRecoverer</code> Class를 구현체를
<code class="language-text">recoverer</code>에 셋팅하면 된다. 라이브러리에서 기본제공되는 <code class="language-text">RepublishMessageRecoverer</code> 클래스도 있긴 하다. 또 간단한게 셋팅하고 싶으면 <code class="language-text">properties</code>로 셋팅이 가능하긴 한데 java로 구현하는게 익숙하니까 pass</p>
<p>참고 사항으로 메세지 처리 중 <code class="language-text">AmqpRejectAndDontRequeueException</code>에러가 발생하면 더이상 재시도 하지 않고 메세지를 소비하고 끝내게 된다.</p>
<h1 id="4-메세지-구조" style="position:relative;"><a href="#4-%EB%A9%94%EC%84%B8%EC%A7%80-%EA%B5%AC%EC%A1%B0" aria-label="4 메세지 구조 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. 메세지 구조</h1>
<p>기본적으로 메세지 구조는 <code class="language-text">header</code> + <code class="language-text">body</code> 형태를 가진다. <code class="language-text">body</code>는 주고받는 메세지 정보를 가지고 있고, <code class="language-text">header</code>에는 어느곳에서 왔는지, <code class="language-text">DLX</code>라면 에러 관련된 정보도 함께 담고 있다.</p>
<p>아래 내용은 일부로 <code class="language-text">consumer</code>를 구성하지 않고 <code class="language-text">TTL</code> 시간만큼 지났을때 수신되는 메세지의 헤더정보를 확인해 보려는 목적으로 구현한 내용이다.</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">  <span class="token comment">//DLX 전용 consumer 메소드</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">failConsumer</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token class-name">Item</span> item <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Item</span><span class="token punctuation">)</span> messageConverter<span class="token punctuation">.</span><span class="token function">fromMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> header <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> exchangeName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> header<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"x-first-death-exchange"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span><span class="token punctuation">></span></span>xDeath <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">)</span>header<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"x-death"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> firstReason <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> header<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"x-first-death-reason"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"타임아웃된 아이템 수신 {}"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>

    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"reason : {}, exchange name : {}"</span><span class="token punctuation">,</span> firstReason<span class="token punctuation">,</span> exchangeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"x-death : {}"</span><span class="token punctuation">,</span> xDeath<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>만약 <code class="language-text">DLX</code> 전용이 아닌 일반 <code class="language-text">consumer</code>라면 헤더 정보가 거의 없을 수도 있지만 <code class="language-text">DLX</code>라면 위 소스에서 에러난 이유, 발생 횟수(<code class="language-text">retry count</code>) 등의 정보를 확인 가능하다.</p>
<p>log 내용 샘플</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">타임아웃된 아이템 수신 Item(data=data1, number=1, isThrow=false)
reason : expired, exchange name : demo-queue-name-exchange
x-death : {reason=expired, count=1, exchange=demo-queue-name-exchange, time=Wed Jul 08 11:15:21 KST 2020, routing-keys=[foo.bar.baz2], queue=demo-queue-name}</code></pre></div>
<h1 id="5-exchange" style="position:relative;"><a href="#5-exchange" aria-label="5 exchange permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Exchange</h1>
<p><code class="language-text">exchange</code>의 역할은 메세지를 전달받아 어느 큐로 전달 할지 결정한다고 하였다. <code class="language-text">exchange</code> 종류로는 크게 3가지가 있다. (<code class="language-text">Header</code> 방식은 생략)</p>
<table>
<thead>
<tr>
<th>종류</th>
<th>설명</th>
<th>용도</th>
</tr>
</thead>
<tbody>
<tr>
<td>Direct</td>
<td>라우팅 키가 정확히 일치</td>
<td>Unicast</td>
</tr>
<tr>
<td>Fanout</td>
<td>라우팅 키 상관없이 등록된 모든 Queue로 전송</td>
<td>Broadcast</td>
</tr>
<tr>
<td>Topic</td>
<td>라우팅 키를 패턴으로 검사하여 패턴에 맞는 모든 Queue로 전송</td>
<td>Multicast</td>
</tr>
</tbody>
</table>
<h3 id="51-direct" style="position:relative;"><a href="#51-direct" aria-label="51 direct permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.1 Direct</h3>
<p>위 테이블에서 설명 한것 그대로 라우팅 키가 정확히 일치하는 <code class="language-text">Queue</code>로 메세지를 전송한다. 라우팅 키가 정확히 일치 해야하므로 <code class="language-text">Unicast</code> 즉 <code class="language-text">Point to Point</code> 방식으로 메세지를 전송한다.</p>
<h3 id="52-fanout" style="position:relative;"><a href="#52-fanout" aria-label="52 fanout permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.2 Fanout</h3>
<p>라우팅키를 분석하지 않고 연결된 모든 <code class="language-text">Queue</code>로 메세지를 전송하는 방식이다. 불특정 다수에게 보내는 방식(<code class="language-text">Broadcast</code>)으로 구독형 방식이라 생각 말 할 수도 있겠지만 <code class="language-text">Rabbitmq</code> 기본이 polling이라는 점도 기억은 해놔야한다.</p>
<h3 id="53-topic" style="position:relative;"><a href="#53-topic" aria-label="53 topic permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5.3 Topic</h3>
<p>라우팅키에 패턴 정보가 있으면 패턴을 분석하여 적합한 <code class="language-text">Queue</code>들 한테 메세지를 전송해준다. <code class="language-text">Direct</code>, <code class="language-text">Fanout</code> 특성이 조금씩 섞여있는 형태로 <code class="language-text">Multicast</code>(수신 대상자들을 특정 할 수 있음)로 쓰인다.</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"queue1"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"queueName1"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"queue2"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token string">"queueName2"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">"topicExchange"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">TopicExchange</span> <span class="token function">exchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TopicExchange</span><span class="token punctuation">(</span><span class="token string">"topicExchangeName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding1</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"queue1"</span><span class="token punctuation">)</span><span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"topicExchange"</span><span class="token punctuation">)</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">"foo.bar.#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">binding2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"queue2"</span><span class="token punctuation">)</span><span class="token class-name">Queue</span> queue<span class="token punctuation">,</span> <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"topicExchange"</span><span class="token punctuation">)</span><span class="token class-name">TopicExchange</span> topicExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>topicExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">"foo.bar.#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre></div>
<p>java를 기준으로 위와 같이 <code class="language-text">topic exchange</code>에 라우팅 키 패턴을 <code class="language-text">foo.bar.#</code>으로 <code class="language-text">queue1</code>, <code class="language-text">queue2</code>를 연결해 놓고 있다가 <code class="language-text">foo.bar.baz1</code>, <code class="language-text">foo.bar.baz2</code>이런식으로 라우팅 키가 들어오면 <code class="language-text">queue1</code>, <code class="language-text">queue2</code>에게 각각 메세지를 전달 해준다.</p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->2020-05-26</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/blog/tag/messagequeue/">messagequeue</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/blog/tag/mq/">mq</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/blog/tag/rabbitmq/">rabbitmq</a></li></ul></div><div class="Author-module--author--2Yefr"><p><a class="Author-module--author__bio-twitter--n-O9n" href="https://github.com/qweasd147" rel="noopener noreferrer" target="_blank"><strong>Kim joohyung</strong> on Github</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div><div class="Layout-module--layout-doc-mask--1C0nh"></div><div class="SideButton-module--sides--BtKaf"><a class="SideButton-module--sides-button--1ZBs9 SideButton-module--sides-button-hide--1UbTc">Up</a></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/etc/etc-rabbitmq/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ddd22c35447b94046b82.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fe3bb41d5112e8efbcdb.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-51378f8c163528582082.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-91cb1145b8cea7061015.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-c284e1532732377ecf23.js"],"component---src-templates-custom-skills-template-js":["/component---src-templates-custom-skills-template-js-83272389441fe9c6a7cc.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-270a650ea9cf9e2562f0.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-17e06f3db6dffdc0abe9.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-318fb5fa7e0888471404.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-ba13ae9f7e97d2353768.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-619a2418c919c20a95dc.js"]};/*]]>*/</script><script src="/blog/component---src-templates-post-template-js-17e06f3db6dffdc0abe9.js" async=""></script><script src="/blog/d4f3f45f3b97a996ebac05174393e9dafe15c3a1-4deb2450f60e37cf9a36.js" async=""></script><script src="/blog/b85ce96f5d2f4665e19992ddb57b3614f7b5719c-5e70df081ad36bfd606c.js" async=""></script><script src="/blog/styles-083a06cb5740baaf347d.js" async=""></script><script src="/blog/app-ddd22c35447b94046b82.js" async=""></script><script src="/blog/532a2f07-1d2a7bbc1a68ccd5edd4.js" async=""></script><script src="/blog/framework-99708135f20a48422ed8.js" async=""></script><script src="/blog/webpack-runtime-a1a700d2a6e364f766c0.js" async=""></script></body></html>